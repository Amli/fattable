(function(){var v,w,x,y,z,A,B;A=function(c){var b,a,e,d,k;b=c.slice(0);a=d=e=b[0]=0;for(k=c.length-1;d<k;a=d+=1)e+=c[a],b[a+1]=e;return b};x=function(){function c(){}c.prototype.hasCell=function(b,a){return!1};c.prototype.hasColumn=function(b){return!1};c.prototype.getCell=function(b,a,e){null==e&&(e=function(){});return setTimeout(function(){return e(b+","+a)},100)};c.prototype.getHeader=function(b,a){null==a&&(a=function(){});return a("col "+b)};return c}();z=function(c,b){var a,e,d,k;if(c[0]>b)return 0;
a=0;for(e=c.length;a+2<e;)if(d=(a+e)/2|0,k=c[d],k<b)a=d;else if(k>b)e=d;else return d;return a};v=function(){function c(){}c.prototype.setupCell=function(b){};c.prototype.setupColumnHeader=function(b){};c.prototype.fillColumnHeader=function(b,a){return b.textContent=a};c.prototype.fillCell=function(b,a){return b.textContent=a};c.prototype.fillColumnHeaderPending=function(b){return b.textContent="NA"};c.prototype.fillCellPending=function(b){return b.textContent="NA"};return c}();B=function(c,b){var a,
e;a=1;for(e=0;e+a<c.length;)c[e+a]-c[e]>b?e+=1:a+=1;return a};w=function(){function c(b,a,e){var d=this;this.container=b;this.W=a;this.H=e;this.verticalScrollbar=document.createElement("div");this.verticalScrollbar.className+=" fattable-v-scrollbar";this.horizontalScrollbar=document.createElement("div");this.horizontalScrollbar.className+=" fattable-h-scrollbar";this.container.appendChild(this.verticalScrollbar);this.container.appendChild(this.horizontalScrollbar);b=document.createElement("div");
b.style.height="1px";b.style.width=this.W+"px";a=document.createElement("div");a.style.width="1px";a.style.height=this.H+"px";this.horizontalScrollbar.appendChild(b);this.verticalScrollbar.appendChild(a);this.scrollTop=this.scrollLeft=0;this.horizontalScrollbar.onscroll=function(){d.scrollLeft=d.horizontalScrollbar.scrollLeft;return d.onScrollXY(d.scrollLeft,d.scrollTop)};this.verticalScrollbar.onscroll=function(){d.scrollTop=d.verticalScrollbar.scrollTop;return d.onScrollXY(d.scrollLeft,d.scrollTop)};
this.container.addEventListener("mousedown",function(a){if(1===a.button)return d.moving=!0,d.moving_dX=d.scrollLeft+a.clientX,d.moving_dY=d.scrollTop+a.clientY});this.container.addEventListener("mouseup",function(){return d.moving=!1});this.container.addEventListener("mousemove",function(a){var b;if(d.moving)return b=-a.clientX+d.moving_dX,a=-a.clientY+d.moving_dY,d.setScrollXY(b,a)});this.container.addEventListener("mouseout",function(a){if(d.moving&&(null===a.toElement||a.toElement.parentElement.parentElement!==
d.container))return d.moving=!1});b=function(a){if("mousewheel"===a.type)return d.setScrollXY(d.scrollLeft,d.scrollTop-a.wheelDelta)};this.container.addEventListener?(this.container.addEventListener("mousewheel",b,!1),this.container.addEventListener("DOMMouseScroll",b,!1)):this.container.attachEvent("onmousewheel",b)}c.prototype.onScrollXY=function(b,a){};c.prototype.setScrollXY=function(b,a){var e;b=Math.max(b,0);b=Math.min(b,this.W);a=Math.max(a,0);a=Math.min(a,this.H);e=this.onScrollXY;this.onScrollXY=
function(){};this.scrollLeft=b;this.scrollTop=a;this.horizontalScrollbar.scrollLeft=b;this.verticalScrollbar.scrollTop=a;this.onScrollXY(b,a);return this.onScrollXY=e};return c}();y=function(){function c(b){var a,e=this;a=b.container;if(null==a)throw"container not specified.";if("string"===typeof a)this.container=document.querySelector(a);else if("object"===typeof a)this.container=a;else throw"Container must be a string or a dom element.";this.readRequiredParameter(b,"painter",new v);this.readRequiredParameter(b,
"data");this.readRequiredParameter(b,"nbRows");this.readRequiredParameter(b,"rowHeight");this.readRequiredParameter(b,"columnWidths");this.readRequiredParameter(b,"rowHeight");this.readRequiredParameter(b,"headerHeight");this.nbCols=this.columnWidths.length;this.container.className+=" fattable";this.H=this.rowHeight*this.nbRows;this.col_offset=A(this.columnWidths);this.W=this.col_offset[this.col_offset.length-1];document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",
arguments.callee);return e.setup()});window.addEventListener("resize",function(){return e.setup()})}c.prototype.readRequiredParameter=function(b,a,e){if(null==b[a]){if(void 0===e)throw"Expected parameter <"+a+">";return this[a]=e}return this[a]=b[a]};c.prototype.visible=function(b,a){var e;e=z(this.col_offset,b);return[a/this.rowHeight|0,e]};c.prototype.setup=function(){var b,a,e,d,c,f=this;this.columns={};this.cells={};this.container.innerHtml="";this.w=this.container.offsetWidth;this.h=this.container.offsetHeight-
this.headerHeight;this.nbColsVisible=B(this.col_offset,this.w)+2;this.nb_rows_visible=(this.h/this.rowHeight|0)+2;this.headerContainer=document.createElement("div");this.headerContainer.className+=" fattable-header-container";this.headerContainer.style.height=this.headerHeight+"px";this.headerViewport=document.createElement("div");this.headerViewport.className="fattable-viewport";this.headerViewport.style.width=this.W+"px";this.headerViewport.style.height=this.headerHeight+"px";this.headerContainer.appendChild(this.headerViewport);
this.bodyContainer=document.createElement("div");this.bodyContainer.className="fattable-body-container";this.bodyContainer.style.top=this.headerHeight+"px";this.bodyViewport=document.createElement("div");this.bodyViewport.className="fattable-viewport";this.bodyViewport.style.width=this.W+"px";this.bodyViewport.style.height=this.H+"px";for(d=b=-this.nbColsVisible;0>b;d=b+=1)for(e=c=-this.nb_rows_visible;0>c;e=c+=1)a=document.createElement("div"),this.painter.setupCell(a),this.bodyViewport.appendChild(a),
this.cells[e+","+d]=a;for(b=c=-this.nbColsVisible;0>c;b=c+=1)a=document.createElement("div"),this.painter.setupColumnHeader(a),this.columns[b]=a,this.headerViewport.appendChild(a);this.firstVisibleRow=-this.nb_rows_visible;this.lastVisibleRow=-this.nbColsVisible;this.goTo(0,0);this.container.appendChild(this.bodyContainer);this.container.appendChild(this.headerContainer);this.bodyContainer.appendChild(this.bodyViewport);this.refreshAllContent();this.scrollBarProxy=new w(this.bodyContainer,this.W,
this.H);return this.scrollBarProxy.onScrollXY=function(a,b){var c;c=f.visible(a,b);e=c[0];d=c[1];f.goTo(e,d);f.headerViewport.style.left=-a+"px";f.bodyViewport.style.left=-a+"px";f.bodyViewport.style.top=-b+"px";clearTimeout(f.scrollEndTimer);return f.scrollEndTimer=setTimeout(f.refreshAllContent.bind(f),200)}};c.prototype.refreshAllContent=function(){var b,a,e,d,c,f,h,g,l,m=this;f=function(a){return m.data.getHeader(d,function(b){return m.painter.fillColumnHeader(a,b)})};l=[];d=h=this.lastVisibleRow;
for(g=this.lastVisibleRow+this.nbColsVisible;h<g;d=h+=1)a=this.columns[d],f(a),l.push(function(){var a,f,g,h=this;g=[];e=a=this.firstVisibleRow;for(f=this.firstVisibleRow+this.nb_rows_visible;a<f;e=a+=1)c=e+","+d,b=this.cells[c],g.push(function(a){return h.data.getCell(e,d,function(b){a.pending=!1;return h.painter.fillCell(a,b)})}(b));return g}.call(this));return l};c.prototype.goTo=function(b,a){this.headerContainer.style.display="none";this.bodyContainer.style.display="none";this.moveX(a);this.moveY(b);
this.headerContainer.style.display="";return this.bodyContainer.style.display=""};c.prototype.moveX=function(b){var a,e,d,c,f,h,g,l,m,p,s,t,q,n,r,u=this;m=this.firstVisibleRow;s=b-this.lastVisibleRow;if(0!==s){h=Math.min(Math.abs(s),this.nbColsVisible);for(a=q=0;q<h;a=q+=1)for(0<s?(p=this.lastVisibleRow+a,f=b+a+this.nbColsVisible-h):(p=this.lastVisibleRow+this.nbColsVisible-h+a,f=b+a),d=this.col_offset[f]+"px",e=this.columnWidths[f]+"px",c=this.columns[p],delete this.columns[p],this.data.hasColumn(f)?
this.data.getHeader(f,function(a){c.pending=!1;return u.painter.fillColumnHeader(c,a)}):c.pending||(c.pending=!0,this.painter.fillColumnHeaderPending(c)),c.style.left=d,c.style.width=e,this.columns[f]=c,t=function(a){if(u.data.hasCell(g,f))return u.data.getCell(g,f,function(b){a.pending=!1;return u.painter.fillCell(a,b)});if(!a.pending)return a.pending=!0,u.painter.fillCellPending(a)},g=n=m,r=m+this.nb_rows_visible;m<=r?n<r:n>r;g=m<=r?++n:--n)l=g+","+p,a=this.cells[l],delete this.cells[l],this.cells[g+
","+f]=a,a.style.left=d,a.style.width=e,t(a);return this.lastVisibleRow=b}};c.prototype.moveY=function(b){var a,c,d,k,f,h,g,l,m,p,s,t,q,n,r=this;h=this.firstVisibleRow;g=this.lastVisibleRow;p=b-h;if(0!==p){d=Math.min(Math.abs(p),this.nb_rows_visible);for(a=t=0;t<d;a=t+=1)for(0<p?(l=h+a,c=b+a+this.nb_rows_visible-d):(l=h+this.nb_rows_visible-d+a,c=b+a),m=c*this.rowHeight+"px",s=function(a){if(r.data.hasCell(c,k))return r.data.getCell(c,k,function(b){a.pending=!1;return r.painter.fillCell(a,b)});if(!a.pending)return a.pending=
!0,r.painter.fillCellPending(a)},k=q=g,n=g+this.nbColsVisible;g<=n?q<n:q>n;k=g<=n?++q:--q)f=l+","+k,a=this.cells[f],delete this.cells[f],this.cells[c+","+k]=a,a.style.top=m,s(a);return this.firstVisibleRow=b}};return c}();window.TableData=x;window.TableView=y;window.CellPainter=v}).call(this);
